<script>
  const fileInput = document.getElementById('file-input');
  const extractedTextElement = document.getElementById('extracted-text');
  const translatedTextElement = document.getElementById('translated-text');
  const uploadedImg = document.getElementById('uploaded-img');
  let extractedText = '';

  fileInput.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(event) {
        uploadedImg.src = event.target.result;
        uploadedImg.style.display = 'block';
      };
      reader.readAsDataURL(file);

      Tesseract.recognize(file, 'eng')
        .then(result => {
          extractedText = result.data.text;
          console.log("Texto extraído antes de limpiar:", extractedText);
          
          // Limpia el texto eliminando caracteres extraños
          extractedText = extractedText.replace(/[^a-zA-Z0-9 .,'!?]/g, ''); // Mantener solo caracteres comunes
          
          console.log("Texto extraído después de limpiar:", extractedText);
          extractedTextElement.textContent = extractedText;
        })
        .catch(error => console.error(error));
    }
  });

  document.getElementById('translate-btn').addEventListener('click', () => {
    if (extractedText.trim() === '') {
      alert('No se pudo extraer ningún texto válido.');
      return;
    }

    fetch(`https://libretranslate.com/translate`, {
      method: 'POST',
      body: JSON.stringify({
        q: extractedText,
        source: 'en',
        target: 'es',
        format: 'text'
      }),
      headers: { "Content-Type": "application/json" }
    })
      .then(response => response.json())
      .then(data => {
        translatedTextElement.textContent = data.translatedText;
      })
      .catch(error => console.error('Error en la traducción:', error));
  });
</script>
